##5-2 子查询

子查询(Subquery)是指出现在其他SQL语句内的SELECT子句子

例如:
   
    SELECT * FROM t1 WHERE col1=(SELECT col2 FROM t2);

其中SELECT*FROM t1，称为Outer Query/Outer Statement

SELECT col2 FROM t2,称为SubQuery

子查询指嵌套在查询内部，且必须始终出现在圆括号内。

子查询可以包含多个关键字或条件，如:DISTINCT、GROUP BY、ORDER BY、LIMIT，函数等。

子查询的外层查询可以是：SELECT,INSERT,UPDATE,SET或DO

子查询可以返回标量，一行，一列或子查询。

##5-3由比较运算符引发的子查询

使用比较运算符的子查询

    =、>、<、>=、<=、<>、!=、<=>

语法结构

    operand comparison_operator subquery

聚合函数：只返回一个值

查询平均值:

    SELECT AVG(goods_price) FROM tdb_goods;

对平均值四舍五入:

    SELECT ROUND(AVG(goods_price),2) FROM tdb_goods;

查询大于某一值:

    SELECT goods_id,goods_name,goods_price FROM tdb_goods WHERE goods_price >=5636.36;

优化：

    SELECT goods_id,goods_name,goods_price FROM tdb_goods WHERE goods_price >=(SELECT ROUND(AVG(goods_price),2) FROM tdb_goods);

查找超极本:

    SELECT goods_price FROM tdb_goods WHERE goods_cate='超级本';

用ANY、SOME、或ALL修饰的比较运算符

    operand comparison_operator ANY (subquery)
    operand comparison_operator SOME (subquery)
    operand comparison_operator ALL (subquery)

| 运算符\关键字 | ANY |SOME |ALL |
| ------ | ------ |
| >、>= | 最小值 |最小值|最大值|
| <、<= | 最大值 |最大值|最小值|
| = | 任意值 |任意值 | |
| <>、!=、 |  | |任意值 |


价格大于超级本(总共有3条)：

    SELECT goods_id,goods_name,goods_price FROM tdb_goods WHERE goods_price > (SELECT goods_price FROM tdb_goods WHERE goods_cate='超级本');

应该修改为

    SELECT goods_id,goods_name,goods_price FROM tdb_goods WHERE goods_price > ANY(SELECT goods_price FROM tdb_goods WHERE goods_cate='超级本');

##5-4由[NOT] IN/EXISTS引发的子查询

语法结构:

operand comparison_operator [NOT] IN (subquery)=ANY 运算符与IN等效。

!=ALL或<>ALL运算符与NOT IN等效。

如:

    SELECT goods_id,goods_name,goods_price FROM tdb_goods WHERE goods_price <> ALL(SELECT goods_price FROM tdb_goods WHERE goods_cate='超级本');

使用[NOT] EXISTS的子查询

如果子查询返回任何行，EXISTS将返回TRUE；否则为FALSE。